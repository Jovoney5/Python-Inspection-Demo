<!DOCTYPE html>
<html>
<head>
    <title>Small Hotels Inspection Form - Jamaica</title>
    <script src="{{ url_for('static', filename='js/offline-forms.js') }}" defer></script>
    <style>
        body {
            font-family: 'Verdana', sans-serif;
            margin: 0;
            padding: 20px;
            background: url('{{ url_for("static", filename="d.jpg") }}') no-repeat center center fixed;
            background-size: cover;
            background-attachment: fixed;
            height: 100%;
            min-height: 100%;
            overflow-y: auto;
            color: #000;
        }
        .form-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-left: 5px solid #000;
            border-right: 5px solid #ffd200;
        }
        .form-header {
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            color: #009b3a;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 3px solid #ffd200;
            padding-bottom: 5px;
        }
        .form-top {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            border: 2px solid #ffd200;
        }
        .form-top > div {
            margin-bottom: 15px;
        }
        .form-top label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
            color: #009b3a;
            font-size: 14px;
        }
        .form-top input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            background: #f9f9f9;
            transition: border-color 0.3s;
        }
        .form-top input:focus {
            border-color: #009b3a;
            outline: none;
            background: #fff;
        }
        .form-top .address {
            grid-column: span 2;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            margin-bottom: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            vertical-align: top;
            border: 1px solid #ddd;
        }
        th {
            background: #f5f5f5;
            font-weight: bold;
        }
        th:nth-child(1), td:nth-child(1) { width: 10%; }
        th:nth-child(2), td:nth-child(2) { width: 50%; }
        th:nth-child(3), td:nth-child(3) { width: 20%; }
        th:nth-child(4), td:nth-child(4) { width: 20%; }
        .category-header {
            font-weight: bold;
            font-size: 16px;
            background: #ffd200;
            color: #000;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            text-transform: uppercase;
        }
        .critical {
            background-color: rgba(0,0,255,0.2);
            border-left: 3px solid #000;
        }
        .input-field {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            background: #f5f5f5;
        }
        .error-input, .obser-input {
            width: 50px;
            text-align: center;
        }
        .input-field:focus, .error-input:focus, .obser-input:focus {
            border-color: #000;
            outline: none;
            background: #fff;
        }
        .comments {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            background: #f5f5f5;
            resize: vertical;
            height: 150px;
        }
        .comments:focus {
            border-color: #000;
            outline: none;
            background: #fff;
        }
        .score-tabs {
            margin: 20px 0;
            padding: 15px;
            background: #f4f4f4;
            border-radius: 8px;
            display: flex;
            gap: 30px;
            justify-content: center;
            border: 2px solid #009b3a;
        }
        .score-tabs > div {
            text-align: center;
        }
        .score-tabs label {
            font-weight: bold;
            font-size: 16px;
            color: #009b3a;
            display: block;
            margin-bottom: 8px;
        }
        .score-tabs input {
            width: 120px;
            padding: 10px;
            border: 2px solid #009b3a;
            border-radius: 5px;
            background: #fff;
            font-size: 18px;
            text-align: center;
            pointer-events: none;
            font-weight: bold;
            color: #009b3a;
        }
        .buttons {
            margin-top: 20px;
            text-align: center;
        }
        .btn {
            padding: 12px 24px;
            margin: 0 5px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: #fff;
            transition: background 0.3s;
            display: inline-block;
        }
        .btn:hover {
            opacity: 0.8;
        }
        #submit-btn { background: #009b3a; }
        #submit-btn:hover { background: #007d2f; }
        #print-btn { background: #ffd200; color: #000; }
        #print-btn:hover { background: #e6b800; }
        #save-btn { background: #000000; }
        #save-btn:hover { background: #333333; }
        #share-btn { background: #17a2b8; }
        #share-btn:hover { background: #138496; }
        #back-btn { background: #5a6268; }
        #back-btn:hover { background: #4b5156; }
        .signature-section {
            margin: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }
        .signature-section div {
            display: flex;
            flex-direction: column;
        }
        .signature-section label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .signature-section input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            background: #f5f5f5;
        }
        .signature-section input:focus {
            border-color: #000;
            outline: none;
            background: #fff;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">Small Hotels Inspection Form - Jamaica</div>
        <form id="inspection-form" method="POST" action="{{ url_for('submit_small_hotels') }}" data-offline-form="true">
            <div class="form-top">
                <div>
                    <label>Hotel Name</label>
                    <input type="text" class="input-field" name="establishment_name" value="{{ inspection.establishment_name if inspection else '' }}" required>
                </div>
                <div>
                    <label>Date</label>
                    <input type="date" class="input-field" name="inspection_date" value="{{ inspection.inspection_date if inspection else today }}" required>
                </div>
                <div>
                    <label>Inspector's ID</label>
                    <input type="text" class="input-field" name="inspector_name" value="{{ inspection.inspector_name if inspection else '' }}" required>
                </div>
                <div class="address">
                    <label>Address</label>
                    <input type="text" class="input-field" name="address" value="{{ inspection.address if inspection else '' }}" required>
                </div>
                <div>
                    <label>Physical Location</label>
                    <input type="text" class="input-field" name="physical_location" value="{{ inspection.physical_location if inspection else '' }}" required>
                </div>
            </div>

            <div class="category-header">1 - Documentation (8%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Action plan for foodborne illness occurrence</td>
                    <td><input type="number" class="input-field obser-input" name="obser_1a" min="0" value="{{ inspection.obser.get('1a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_1a" min="0" value="{{ inspection.error.get('1a', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>B</td>
                    <td>Food Handlers have valid food handlers permits</td>
                    <td><input type="number" class="input-field obser-input" name="obser_1b" min="0" value="{{ inspection.obser.get('1b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_1b" min="0" value="{{ inspection.error.get('1b', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>C</td>
                    <td>Relevant policy in place to restrict activities of sick employees</td>
                    <td><input type="number" class="input-field obser-input" name="obser_1c" min="0" value="{{ inspection.obser.get('1c', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_1c" min="0" value="{{ inspection.error.get('1c', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>D</td>
                    <td>Establishments have a written policy for the proper disposal of waste</td>
                    <td><input type="number" class="input-field obser-input" name="obser_1d" min="0" value="{{ inspection.obser.get('1d', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_1d" min="0" value="{{ inspection.error.get('1d', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>E</td>
                    <td>Cleaning schedule for equipment utensil etc available</td>
                    <td><input type="number" class="input-field obser-input" name="obser_1e" min="0" value="{{ inspection.obser.get('1e', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_1e" min="0" value="{{ inspection.error.get('1e', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>F</td>
                    <td>Material safety data sheet available for record of hazardous chemicals used</td>
                    <td><input type="number" class="input-field obser-input" name="obser_1f" min="0" value="{{ inspection.obser.get('1f', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_1f" min="0" value="{{ inspection.error.get('1f', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>G</td>
                    <td>Record of hazardous chemicals used</td>
                    <td><input type="number" class="input-field obser-input" name="obser_1g" min="0" value="{{ inspection.obser.get('1g', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_1g" min="0" value="{{ inspection.error.get('1g', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>H</td>
                    <td>Food suppliers list available</td>
                    <td><input type="number" class="input-field obser-input" name="obser_1h" min="0" value="{{ inspection.obser.get('1h', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_1h" min="0" value="{{ inspection.error.get('1h', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">2 - Food Handlers (5%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr class="critical">
                    <td>A</td>
                    <td>Clean appropriate protective garments</td>
                    <td><input type="number" class="input-field obser-input" name="obser_2a" min="0" value="{{ inspection.obser.get('2a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_2a" min="0" value="{{ inspection.error.get('2a', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>Hands free of jewellery</td>
                    <td><input type="number" class="input-field obser-input" name="obser_2b" min="0" value="{{ inspection.obser.get('2b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_2b" min="0" value="{{ inspection.error.get('2b', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>C</td>
                    <td>Suitable hair restraints</td>
                    <td><input type="number" class="input-field obser-input" name="obser_2c" min="0" value="{{ inspection.obser.get('2c', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_2c" min="0" value="{{ inspection.error.get('2c', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>D</td>
                    <td>Nails clean, short and unpolished</td>
                    <td><input type="number" class="input-field obser-input" name="obser_2d" min="0" value="{{ inspection.obser.get('2d', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_2d" min="0" value="{{ inspection.error.get('2d', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>E</td>
                    <td>Hands washed as required</td>
                    <td><input type="number" class="input-field obser-input" name="obser_2e" min="0" value="{{ inspection.obser.get('2e', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_2e" min="0" value="{{ inspection.error.get('2e', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">3 - Food Storage (13%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr class="critical">
                    <td>A</td>
                    <td>Approved source</td>
                    <td><input type="number" class="input-field obser-input" name="obser_3a" min="0" value="{{ inspection.obser.get('3a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_3a" min="0" value="{{ inspection.error.get('3a', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>Correct stocking procedures practiced</td>
                    <td><input type="number" class="input-field obser-input" name="obser_3b" min="0" value="{{ inspection.obser.get('3b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_3b" min="0" value="{{ inspection.error.get('3b', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>C</td>
                    <td>Food stored on pallets or shelves off the floor</td>
                    <td><input type="number" class="input-field obser-input" name="obser_3c" min="0" value="{{ inspection.obser.get('3c', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_3c" min="0" value="{{ inspection.error.get('3c', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>D</td>
                    <td>No cats, rodents or other animals present in the store</td>
                    <td><input type="number" class="input-field obser-input" name="obser_3d" min="0" value="{{ inspection.obser.get('3d', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_3d" min="0" value="{{ inspection.error.get('3d', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>E</td>
                    <td>Products free of infestation</td>
                    <td><input type="number" class="input-field obser-input" name="obser_3e" min="0" value="{{ inspection.obser.get('3e', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_3e" min="0" value="{{ inspection.error.get('3e', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>F</td>
                    <td>No pesticides or other hazardous chemicals in food stores</td>
                    <td><input type="number" class="input-field obser-input" name="obser_3f" min="0" value="{{ inspection.obser.get('3f', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_3f" min="0" value="{{ inspection.error.get('3f', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>G</td>
                    <td>Satisfactory condition of refrigeration units</td>
                    <td><input type="number" class="input-field obser-input" name="obser_3g" min="0" value="{{ inspection.obser.get('3g', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_3g" min="0" value="{{ inspection.error.get('3g', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>H</td>
                    <td>Refrigerated foods < 4°C</td>
                    <td><input type="number" class="input-field obser-input" name="obser_3h" min="0" value="{{ inspection.obser.get('3h', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_3h" min="0" value="{{ inspection.error.get('3h', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>I</td>
                    <td>Frozen foods -18°C</td>
                    <td><input type="number" class="input-field obser-input" name="obser_3i" min="0" value="{{ inspection.obser.get('3i', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_3i" min="0" value="{{ inspection.error.get('3i', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">4 - Food Holding and Preparation Practices (8%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr class="critical">
                    <td>A</td>
                    <td>Foods thawed according to recommended procedures</td>
                    <td><input type="number" class="input-field obser-input" name="obser_4a" min="0" value="{{ inspection.obser.get('4a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_4a" min="0" value="{{ inspection.error.get('4a', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>B</td>
                    <td>No evidence of cross-contamination during preparation</td>
                    <td><input type="number" class="input-field obser-input" name="obser_4b" min="0" value="{{ inspection.obser.get('4b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_4b" min="0" value="{{ inspection.error.get('4b', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>C</td>
                    <td>No evidence of cross-contamination during holding in refrigerators/coolers</td>
                    <td><input type="number" class="input-field obser-input" name="obser_4c" min="0" value="{{ inspection.obser.get('4c', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_4c" min="0" value="{{ inspection.error.get('4c', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>D</td>
                    <td>Foods cooled according to recommended procedures</td>
                    <td><input type="number" class="input-field obser-input" name="obser_4d" min="0" value="{{ inspection.obser.get('4d', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_4d" min="0" value="{{ inspection.error.get('4d', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>E</td>
                    <td>Manual dishwashing wash, rinse, sanitize, rinse technique</td>
                    <td><input type="number" class="input-field obser-input" name="obser_4e" min="0" value="{{ inspection.obser.get('4e', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_4e" min="0" value="{{ inspection.error.get('4e', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>F</td>
                    <td>Food contact surfaces washed-rinsed-sanitized before & after each use</td>
                    <td><input type="number" class="input-field obser-input" name="obser_4f" min="0" value="{{ inspection.obser.get('4f', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_4f" min="0" value="{{ inspection.error.get('4f', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>G</td>
                    <td>Wiping cloths handled properly (sanitizing solution used)</td>
                    <td><input type="number" class="input-field obser-input" name="obser_4g" min="0" value="{{ inspection.obser.get('4g', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_4g" min="0" value="{{ inspection.error.get('4g', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">5 - Post preparation (10%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr class="critical">
                    <td>A</td>
                    <td>Food protected during transportation</td>
                    <td><input type="number" class="input-field obser-input" name="obser_5a" min="0" value="{{ inspection.obser.get('5a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_5a" min="0" value="{{ inspection.error.get('5a', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>Dishes identified and labelled</td>
                    <td><input type="number" class="input-field obser-input" name="obser_5b" min="0" value="{{ inspection.obser.get('5b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_5b" min="0" value="{{ inspection.error.get('5b', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>C</td>
                    <td>Food covered or protected from contamination</td>
                    <td><input type="number" class="input-field obser-input" name="obser_5c" min="0" value="{{ inspection.obser.get('5c', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_5c" min="0" value="{{ inspection.error.get('5c', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>D</td>
                    <td>Sufficient, appropriate utensils on service line</td>
                    <td><input type="number" class="input-field obser-input" name="obser_5d" min="0" value="{{ inspection.obser.get('5d', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_5d" min="0" value="{{ inspection.error.get('5d', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>E</td>
                    <td>Hot holding temperatures > 63°C</td>
                    <td><input type="number" class="input-field obser-input" name="obser_5e" min="0" value="{{ inspection.obser.get('5e', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_5e" min="0" value="{{ inspection.error.get('5e', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>F</td>
                    <td>Cold holding temperatures ≤ 5°C</td>
                    <td><input type="number" class="input-field obser-input" name="obser_5f" min="0" value="{{ inspection.obser.get('5f', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_5f" min="0" value="{{ inspection.error.get('5f', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">6 - Hand Washing Facilities (3%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr class="critical">
                    <td>A</td>
                    <td>Hand washing facility installed and maintained for every 40 square meters of floor space or in each principal food area</td>
                    <td><input type="number" class="input-field obser-input" name="obser_6a" min="0" value="{{ inspection.obser.get('6a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_6a" min="0" value="{{ inspection.error.get('6a', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>Equipped with hot and cold water, soap dispenser and hand drying facility</td>
                    <td><input type="number" class="input-field obser-input" name="obser_6b" min="0" value="{{ inspection.obser.get('6b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_6b" min="0" value="{{ inspection.error.get('6b', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">7 - Building (8.5%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Provides adequate space</td>
                    <td><input type="number" class="input-field obser-input" name="obser_7a" min="0" value="{{ inspection.obser.get('7a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_7a" min="0" value="{{ inspection.error.get('7a', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>B</td>
                    <td>Food areas kept clean, free from vermin and unpleasant odours</td>
                    <td><input type="number" class="input-field obser-input" name="obser_7b" min="0" value="{{ inspection.obser.get('7b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_7b" min="0" value="{{ inspection.error.get('7b', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>C</td>
                    <td>Floor, walls and ceiling clean, in good repair</td>
                    <td><input type="number" class="input-field obser-input" name="obser_7c" min="0" value="{{ inspection.obser.get('7c', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_7c" min="0" value="{{ inspection.error.get('7c', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>D</td>
                    <td>Mechanical ventilation operable where required</td>
                    <td><input type="number" class="input-field obser-input" name="obser_7d" min="0" value="{{ inspection.obser.get('7d', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_7d" min="0" value="{{ inspection.error.get('7d', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>E</td>
                    <td>Lighting adequate for food preparation and cleaning</td>
                    <td><input type="number" class="input-field obser-input" name="obser_7e" min="0" value="{{ inspection.obser.get('7e', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_7e" min="0" value="{{ inspection.error.get('7e', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>F</td>
                    <td>General housekeeping satisfactory</td>
                    <td><input type="number" class="input-field obser-input" name="obser_7f" min="0" value="{{ inspection.obser.get('7f', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_7f" min="0" value="{{ inspection.error.get('7f', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>G</td>
                    <td>Animals, insect and pest excluded</td>
                    <td><input type="number" class="input-field obser-input" name="obser_7g" min="0" value="{{ inspection.obser.get('7g', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_7g" min="0" value="{{ inspection.error.get('7g', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">8 - Food contact surfaces (3%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Made from material which is non-absorbent and non-toxic</td>
                    <td><input type="number" class="input-field obser-input" name="obser_8a" min="0" value="{{ inspection.obser.get('8a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_8a" min="0" value="{{ inspection.error.get('8a', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>Smooth, cleanable, corrosion resistant</td>
                    <td><input type="number" class="input-field obser-input" name="obser_8b" min="0" value="{{ inspection.obser.get('8b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_8b" min="0" value="{{ inspection.error.get('8b', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>C</td>
                    <td>Proper storage and use of clean utensils</td>
                    <td><input type="number" class="input-field obser-input" name="obser_8c" min="0" value="{{ inspection.obser.get('8c', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_8c" min="0" value="{{ inspection.error.get('8c', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">9 - Food flow (5.5%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr class="critical">
                    <td>A</td>
                    <td>Employee traffic pattern avoids food cross-contamination</td>
                    <td><input type="number" class="input-field obser-input" name="obser_9a" min="0" value="{{ inspection.obser.get('9a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_9a" min="0" value="{{ inspection.error.get('9a', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>B</td>
                    <td>Product flow not at risk for cross-contamination</td>
                    <td><input type="number" class="input-field obser-input" name="obser_9b" min="0" value="{{ inspection.obser.get('9b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_9b" min="0" value="{{ inspection.error.get('9b', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>C</td>
                    <td>Living quarters, toilets, washrooms, locker separated from areas where food is handled</td>
                    <td><input type="number" class="input-field obser-input" name="obser_9c" min="0" value="{{ inspection.obser.get('9c', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_9c" min="0" value="{{ inspection.error.get('9c', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">10 - Equipment and utensils sanitization (9.5%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Mechanical dishwashing: Wash-rinse water clean</td>
                    <td><input type="number" class="input-field obser-input" name="obser_10a" min="0" value="{{ inspection.obser.get('10a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_10a" min="0" value="{{ inspection.error.get('10a', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>Proper water temperature</td>
                    <td><input type="number" class="input-field obser-input" name="obser_10b" min="0" value="{{ inspection.obser.get('10b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_10b" min="0" value="{{ inspection.error.get('10b', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>C</td>
                    <td>Proper timing of cycles</td>
                    <td><input type="number" class="input-field obser-input" name="obser_10c" min="0" value="{{ inspection.obser.get('10c', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_10c" min="0" value="{{ inspection.error.get('10c', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>D</td>
                    <td>Sanitizer for low temperature</td>
                    <td><input type="number" class="input-field obser-input" name="obser_10d" min="0" value="{{ inspection.obser.get('10d', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_10d" min="0" value="{{ inspection.error.get('10d', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>E</td>
                    <td>Proper handling of hazardous materials</td>
                    <td><input type="number" class="input-field obser-input" name="obser_10e" min="0" value="{{ inspection.obser.get('10e', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_10e" min="0" value="{{ inspection.error.get('10e', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">11 - Waste Management: Waste Containers (3%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Appropriate design, convenient placement</td>
                    <td><input type="number" class="input-field obser-input" name="obser_11a" min="0" value="{{ inspection.obser.get('11a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_11a" min="0" value="{{ inspection.error.get('11a', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>Kept covered when not in continuous use</td>
                    <td><input type="number" class="input-field obser-input" name="obser_11b" min="0" value="{{ inspection.obser.get('11b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_11b" min="0" value="{{ inspection.error.get('11b', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>C</td>
                    <td>Emptied as often as necessary</td>
                    <td><input type="number" class="input-field obser-input" name="obser_11c" min="0" value="{{ inspection.obser.get('11c', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_11c" min="0" value="{{ inspection.error.get('11c', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">Solid Waste Storage Area (4%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>D</td>
                    <td>Insect and vermin-proof containers provided where required</td>
                    <td><input type="number" class="input-field obser-input" name="obser_12d" min="0" value="{{ inspection.obser.get('12d', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_12d" min="0" value="{{ inspection.error.get('12d', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>E</td>
                    <td>The area around each waste container kept clean</td>
                    <td><input type="number" class="input-field obser-input" name="obser_12e" min="0" value="{{ inspection.obser.get('12e', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_12e" min="0" value="{{ inspection.error.get('12e', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>F</td>
                    <td>Effluent from waste bins disposed of in a sanitary manner</td>
                    <td><input type="number" class="input-field obser-input" name="obser_12f" min="0" value="{{ inspection.obser.get('12f', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_12f" min="0" value="{{ inspection.error.get('12f', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>G</td>
                    <td>Frequency of garbage removal adequate</td>
                    <td><input type="number" class="input-field obser-input" name="obser_12g" min="0" value="{{ inspection.obser.get('12g', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_12g" min="0" value="{{ inspection.error.get('12g', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">Disposal of solid waste</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr class="critical">
                    <td>H</td>
                    <td>Garbage, refuse properly disposed of, facilities maintained</td>
                    <td><input type="number" class="input-field obser-input" name="obser_13h" min="0" value="{{ inspection.obser.get('13h', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_13h" min="0" value="{{ inspection.error.get('13h', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">12 - Hazardous Materials Storage, Handling and Disposal (4%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Hazardous materials stored in properly labelled containers</td>
                    <td><input type="number" class="input-field obser-input" name="obser_14a" min="0" value="{{ inspection.obser.get('14a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_14a" min="0" value="{{ inspection.error.get('14a', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>B</td>
                    <td>Stored away from living quarters and food areas</td>
                    <td><input type="number" class="input-field obser-input" name="obser_14b" min="0" value="{{ inspection.obser.get('14b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_14b" min="0" value="{{ inspection.error.get('14b', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">13 - Sanitary Facilities (4%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr class="critical">
                    <td>A</td>
                    <td>Approved Sewage Disposal System</td>
                    <td><input type="number" class="input-field obser-input" name="obser_15a" min="0" value="{{ inspection.obser.get('15a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_15a" min="0" value="{{ inspection.error.get('15a', '') if inspection else '' }}"></td>
                </tr>
                <tr class="critical">
                    <td>B</td>
                    <td>Sanitary maintenance of facilities and protection against the entrance of vermin, rodents, dust, and fumes</td>
                    <td><input type="number" class="input-field obser-input" name="obser_15b" min="0" value="{{ inspection.obser.get('15b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_15b" min="0" value="{{ inspection.error.get('15b', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">14 - Pest Control (2%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Adequate provision against the entrance of insects, vermin, rodents, dust and fumes</td>
                    <td><input type="number" class="input-field obser-input" name="obser_16a" min="0" value="{{ inspection.obser.get('16a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_16a" min="0" value="{{ inspection.error.get('16a', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>Suitable pest control programme</td>
                    <td><input type="number" class="input-field obser-input" name="obser_16b" min="0" value="{{ inspection.obser.get('16b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_16b" min="0" value="{{ inspection.error.get('16b', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">15 - Sanitary Engineering: Water supply (3%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Approved source(s) sufficient pressure and capacity</td>
                    <td><input type="number" class="input-field obser-input" name="obser_17a" min="0" value="{{ inspection.obser.get('17a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_17a" min="0" value="{{ inspection.error.get('17a', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>Water quality satisfactory</td>
                    <td><input type="number" class="input-field obser-input" name="obser_17b" min="0" value="{{ inspection.obser.get('17b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_17b" min="0" value="{{ inspection.error.get('17b', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">16 - Sanitary Engineering: Ice (1.5%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Satisfactory ice storage conditions</td>
                    <td><input type="number" class="input-field obser-input" name="obser_18a" min="0" value="{{ inspection.obser.get('18a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_18a" min="0" value="{{ inspection.error.get('18a', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">17 - Sanitary Engineering: Grey Water Facilities (1%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Traps and vent in good condition</td>
                    <td><input type="number" class="input-field obser-input" name="obser_19a" min="0" value="{{ inspection.obser.get('19a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_19a" min="0" value="{{ inspection.error.get('19a', '') if inspection else '' }}"></td>
                </tr>
                <tr>
                    <td>B</td>
                    <td>Floor drains clear and drain freely</td>
                    <td><input type="number" class="input-field obser-input" name="obser_19b" min="0" value="{{ inspection.obser.get('19b', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_19b" min="0" value="{{ inspection.error.get('19b', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="category-header">18 - Sanitary Engineering: Manholes (0.5%)</div>
            <table>
                <tr>
                    <th>Item</th>
                    <th>Details</th>
                    <th>Obser</th>
                    <th>Error</th>
                </tr>
                <tr>
                    <td>A</td>
                    <td>Properly constructed with vents and traps where necessary</td>
                    <td><input type="number" class="input-field obser-input" name="obser_20a" min="0" value="{{ inspection.obser.get('20a', '') if inspection else '' }}"></td>
                    <td><input type="number" class="input-field error-input" name="error_20a" min="0" value="{{ inspection.error.get('20a', '') if inspection else '' }}"></td>
                </tr>
            </table>

            <div class="score-tabs">
                <div>
                    <label>Critical Score:</label>
                    <input type="text" id="critical_score" readonly value="0%">
                </div>
                <div>
                    <label>Overall Score:</label>
                    <input type="text" id="overall_score" readonly value="0%">
                </div>
            </div>

            <div class="form-header">Inspector's Comments</div>
            <textarea class="comments" name="comments">{{ inspection.comments if inspection else '' }}</textarea>

            <div class="form-header">Signatures</div>
            <div class="signature-section">
                <div>
                    <label>Inspector Signature</label>
                    <input type="text" class="input-field" name="inspector_signature" value="{{ inspection.inspector_signature if inspection else '' }}" required>
                    <label>Date</label>
                    <input type="date" class="input-field" name="inspector_signature_date" value="{{ inspection.inspector_signature_date if inspection else today }}" required>
                </div>
                <div>
                    <label>Manager Signature</label>
                    <input type="text" class="input-field" name="manager_signature" value="{{ inspection.manager_signature if inspection else '' }}" required>
                    <label>Date</label>
                    <input type="date" class="input-field" name="manager_signature_date" value="{{ inspection.manager_signature_date if inspection else today }}" required>
                </div>
                <div>
                    <label>Received By</label>
                    <input type="text" class="input-field" name="received_by" value="{{ inspection.received_by if inspection else '' }}" required>
                    <label>Date</label>
                    <input type="date" class="input-field" name="received_by_date" value="{{ inspection.received_by_date if inspection else today }}" required>
                </div>
            </div>

            <div class="buttons">
                <button id="submit-btn" class="btn" type="submit">Submit</button>
                <button id="print-btn" class="btn" type="button" onclick="window.print()">Print</button>
                <button id="save-btn" class="btn" type="button" onclick="saveOffline()">Save</button>
                <button id="share-btn" class="btn" type="button" onclick="shareForm()">Share</button>
                <a href="{{ url_for('dashboard') }}" id="back-btn" class="btn">Back to Dashboard</a>
            </div>
        </form>
        {% if success %}
            <p style="text-align: center; color: #009b3a; font-size: 16px; margin-top: 20px;">Submission successful!</p>
            <div class="buttons">
                <a href="{{ url_for('dashboard') }}" id="back-btn" class="btn">Back to Dashboard</a>
            </div>
        {% endif %}
    </div>

    <script>
        // Critical items based on form's blue highlighting
        const criticalItems = [
            '1b', '2a', '2e', '3a', '3d', '3f', '3h', '3i', '4a', '4b', '4c', '4d', '4e',
            '5a', '5c', '5d', '5e', '5f', '6a', '7b', '9a', '9b', '9c', '10c', '12e',
            '13h', '14b', '15a', '15b'
        ];

        const errorInputs = document.querySelectorAll('.error-input');
        const obserInputs = document.querySelectorAll('.obser-input');
        const criticalScoreInput = document.getElementById('critical_score');
        const overallScoreInput = document.getElementById('overall_score');

        function updateScores() {
            let criticalTotalObser = 0;
            let criticalTotalError = 0;
            let overallTotalObser = 0;
            let overallTotalError = 0;

            errorInputs.forEach((errorInput, index) => {
                const obserInput = obserInputs[index];
                const itemId = errorInput.name.replace('error_', '');
                const obserValue = parseInt(obserInput.value) || 0;
                const errorValue = parseInt(errorInput.value) || 0;

                // Only count items with non-zero observations
                if (obserValue > 0) {
                    overallTotalObser += obserValue;
                    overallTotalError += errorValue;

                    if (criticalItems.includes(itemId)) {
                        criticalTotalObser += obserValue;
                        criticalTotalError += errorValue;
                    }
                }
            });

            // Calculate percentages based on error-to-observation ratio
            let criticalPercentage = criticalTotalObser > 0 ? Math.round(((criticalTotalObser - criticalTotalError) / criticalTotalObser) * 100) : 0;
            let overallPercentage = overallTotalObser > 0 ? Math.round(((overallTotalObser - overallTotalError) / overallTotalObser) * 100) : 0;

            criticalScoreInput.value = criticalPercentage + '%';
            overallScoreInput.value = overallPercentage + '%';
        }

        // Force initial scores to 0%
        criticalScoreInput.value = '0%';
        overallScoreInput.value = '0%';

        // Add event listeners to both observation and error inputs
        errorInputs.forEach(input => {
            input.addEventListener('input', updateScores);
            input.addEventListener('change', updateScores);
        });

        obserInputs.forEach(input => {
            input.addEventListener('input', updateScores);
            input.addEventListener('change', updateScores);
        });

        // Offline functionality
        function saveOffline() {
            const formData = new FormData(document.getElementById('inspection-form'));
            const data = Object.fromEntries(formData.entries());
            localStorage.setItem('small_hotels_inspection', JSON.stringify(data));
            alert('Form saved offline successfully!');
        }

        function shareForm() {
            if (navigator.share) {
                navigator.share({
                    title: 'Small Hotels Inspection Form',
                    text: 'Inspection form data',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Form URL copied to clipboard!');
                });
            }
        }
    </script>
</body>
</html>